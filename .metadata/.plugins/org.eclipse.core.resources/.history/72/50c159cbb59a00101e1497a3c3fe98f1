package player.tinymod;

public final class Mixer {
  private static final int BUF = 8820; // 0.1s for 44100Hz
  private final short[] buffer = new short[BUF];
  private final int[] left = new int[BUF / 2];
  private final int[] right = new int[BUF / 2];
  private final AudioDevice audio;
  private final ModPlayer player;

  public Mixer(final ModPlayer player, final AudioDevice audio) {
    this.player = player;
    this.audio = audio;
  }

  public void mix() {
    if (player != null)
      player.process(left, right, BUF / 2);
    for (int i = 0; i < BUF / 2; i++) {
      buffer[i * 2] = (short)Tools.crop(left[i], -32768, 32767);
      buffer[i * 2 + 1] = (short)Tools.crop(right[i], -32768, 32767);
    }
    audio.write(buffer);
  }
}
